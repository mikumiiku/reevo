---
marp: true

---
# ReEvo: 基于大语言模型的启发式演化框架

## 为什么需要 ReEvo？

### 传统启发式的痛点
- 依赖专家经验
- 调参耗时
- 跨问题迁移差

### 大语言模型的机会
- 具备编码与解释能力
- 自然语言提示即可产出完整算法
- ReEvo 作为"语言型超启发式"

### ReEvo 定位
将 LLM 当作"语言型超启发式"，自动提出并改进求解策略，同时保持人类可阅读、可审计的实现。

---

## ReEvo 的数学表述

### 超启发式视角
ReEvo 在开放的启发式空间 H 中搜索候选 h，以最小化元目标函数 F(h)：
```
h* = argmin(h∈H) F(h)
```
其中 F(h) 表示在问题实例分布上评估得到的期望性能。

### 语言型超启发式
与传统 HH 只在有限算子集合中组合不同，ReEvo 让 LLM 直接生成 H 内的候选代码，因此 H 由提示驱动、理论上无限大。

---

## 遗传算法在 ReEvo 中的体现

1. **选择**：保留表现稳定的解作为"父母代"
2. **交叉**：系统把两段优秀启发式的要点写成合并提示，指示 LLM 产出新"子代"代码
3. **变异**：额外请求"高变异"个体，强调尝试新特征、新归一化或随机扰动
4. **适者生存**：持续跟踪全局最优启发式，一旦发现更优结果就更新"冠军"代码

### 核心创新
将传统"染色体"替换成 LLM 生成的可执行启发式代码，让遗传机制驱动大模型进行创造性迭代。

---

## 蚁群算法求解 TSP

### 路径构造
每只蚂蚁在选择下一城市 j 的概率为：
```
P(i,j) = (τ(i,j))^α * (η(i,j))^β / Σ(k∈N(i)) (τ(i,k))^α * (η(i,k))^β
```
其中 τ(i,j) 代表信息素强度，η(i,j) 为启发式信息。

### 信息素更新
```
τ(i,j) ← (1-ρ) * τ(i,j) + Σ(m∈ants) Δτ(m)(i,j)
```
更短的路径会带来更大增益，形成正反馈收敛。

---

## ReEvo 如何给 ACO 注入启发式

| 流程阶段 | 说明 |
|---------|------|
| 数据准备 | 自动读取节点坐标，计算欧氏距离矩阵 |
| 启发式设计 | LLM 生成"偏好矩阵"，编码多种策略信息 |
| 遗传操作 | 交叉组合亮点策略，变异引导全新想法 |
| ACO 运行 | 利用启发式矩阵与信息素共同计算转移概率 |
| 评估与反馈 | 记录运行日志，为下一轮提示提供素材 |

### 实践洞察
- 短期反思记录"为什么超时/陷入局部最优"
- 长期反思汇总"哪些特征或参数组合有效"
- 输出是自然语言描述 + 可读代码，便于理解策略

---

## 阶段性表现

| 阶段 | 数据规模 | 平均巡回长度 | 备注 |
|------|---------|-------------|------|
| 种子启发式 | 50 节点训练集 | 6.66 | 基准能力 |
| 第一轮候选 | 50 节点训练集 | 6.35 | 运行更快但存在 bug |
| 最佳启发式 | 20/50/100 节点验证集 | 3.87/6.20/9.46 | 最终冠军代码 |

### 关键成果
通过迭代演化，ReEvo 在不同规模的 TSP 实例上都显著提升了求解质量。

---

## 传统遗传算法的局限性

### 两个根本问题
1. **短视贪婪**：只依据当前适应度选择，忽略个体长期演化潜力
2. **过早收敛**：优秀个体垄断繁殖机会，导致种群多样性丧失

### 核心洞察
在启发式空间搜索中，一个看似平庸的启发式可能孕育出突破性的后代！

---

## 家族潜力 (FP) 概念

### 核心思想
评估个体价值不仅看当前表现，更看其整个家族的未来潜力。一个当前表现平平但能孕育出突破性后代的个体，比当前优秀但无法进化的个体更有价值。

### 家族潜力公式
```
FP(a) = α * min(a'∈C(a)) obj(a') + β * avg(a'∈C(a)) obj(a') - γ * std(a'∈C(a)) obj(a')
```

| 参数 | 值 | 说明 |
|------|----|----- |
| α | 0.5 | 最优后代权重 |
| β | 0.3 | 平均表现权重 |
| γ | 0.2 | 多样性奖励权重 |

---

## 家族追踪系统

### 扩展数据结构
```
individual = {
    # 原有字段
    'code': str, 
    'obj': float, 
    'exec_success': bool,
    
    # 家族字段
    'id': str,
    'parent_ids': List[str],
    'generation': int,
    'Family_id': str,
    
    # 家族统计
    'family_best_obj': float,
    'family_avg_obj': float,
    'family_size': int,
    'family_diversity': float,
}
```

### 家族统计更新
对每个家族 L，定期计算：
```
best(L) = min(a∈L) obj(a)
avg(L) = (1/|L|) * Σ(a∈L) obj(a)
div(L) = std(a∈L) obj(a) / (mean(a∈L) obj(a) + ε)
```

---

## 三层选择策略

### 选择公式
给定种群 P，目标选择大小 S：
```
S(elite) = ⌊S * r(elite)⌋
S(Family) = ⌊S * r(Family)⌋
S(revival) = S - S(elite) - S(Family)
```

默认比例：r(elite) : r(Family) : r(revival) = 0.5 : 0.3 : 0.2

### 三种选择方式

| 选择类型 | 公式 | 特点 |
|---------|------|------|
| 精英选择 | sort(P, obj)[:S(elite)] | 当前最优 |
| 家族选择 | sort(P, FP)[:S(Family)] | 长期潜力 |
| 复活选择 | sort(P, revival_score)[:S(revival)] | 多样性 |

---

## 复活变异机制

### 动机
传统 GA 中，未被选中的个体直接被丢弃，这浪费了潜在的基因。复活机制给这些个体第二次机会。

### 家族上下文引导
```
Family Information:
- Best Ancestor Score: best_L
- Average Family Score: avg_L  
- Family Diversity: div_L
- Current Individual Score: obj(a)

Task: Generate BOLD mutation considering Family strengths 
      and avoiding historical weaknesses.
```

### 大胆变异策略
1. **大幅重构**：改变核心算法思路
2. **特征融合**：结合不同家族的优势
3. **探索创新**：尝试全新的启发式特征

---

## 完整演化流程

### 算法伪代码
```
Initialize FamilyTracker
Register seed and initial population (each as independent Family)

while function_evals < max_fe:
    1. 家族统计更新: Update family statistics for all individuals
    2. 三层选择: selected = Family_aware_select(population)
    3. 短期反思: reflection_tuple = short_term_reflection(selected)
    4. 交叉操作: offspring = crossover(reflection_tuple)
    5. 变异操作: mutants = mutate()
    6. 复活变异: revival_offspring = revival_mutate(unselected)
    7. 长期反思: long_term_reflection(reflection_tuple[0])
    8. 种群更新: population = evaluate(all offspring)

return best_individual_overall
```

---

## 关键创新点

1. **家族感知**：选择考虑长期潜力而非短期表现
2. **多样性维护**：三层选择确保探索与利用平衡
3. **第二次机会**：复活机制避免基因浪费
4. **上下文引导**：LLM 变异时利用家族历史信息

### 理论意义
成功将理论洞察转化为实用的遗传算法改进，在保持算法简洁性的同时显著提升了搜索的长期视角和多样性维护能力。

---

## 性能对比

| 方法 | TSP-20 | TSP-50 | TSP-100 |
|------|--------|--------|---------|
| 传统GA | 3.87 | 6.20 | 9.46 |
| 家族GA | **3.86** | **5.85** | **8.39** |
| GA种子 | - | 6.61 | - |

### 关键结果
- 在所有测试规模上都有改进
- 大规模问题改进更明显
- 避免了过早收敛

### 适用场景
- ✅ 搜索空间复杂
- ✅ 需要保持多样性
- ✅ 启发式空间搜索
- ✅ 大模型驱动合成

---

## 总结与展望

### 主要贡献
1. 提出了家族潜力(FP)概念，平衡当前表现与长期潜力
2. 设计了三层选择策略，确保探索与利用的平衡
3. 实现了复活变异机制，充分利用遗传信息
4. 在 TSP-ACO 任务上验证了有效性

### 未来方向
1. **自适应比例**：根据演化阶段动态调整三层选择比例
2. **多目标扩展**：应用到多目标优化场景
3. **谱系可视化**：生成演化树的可视化分析
4. **增量学习**：从历史运行中学习最优配置

### 结论
家族选择与复活机制为传统遗传算法提供了新的设计思路，不仅适用于 ReEvo 的启发式搜索，也为其他演化算法带来了启发。
